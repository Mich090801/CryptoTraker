<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial de Criptomoneda</title>
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #1f1f1f;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
    }

    header h1 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
    }

    header nav a {
      color: #ccc;
      margin: 0 1rem;
      text-decoration: none;
    }

    header nav a:hover {
      color: #fff;
    }

    .container {
      max-width: 800px;
      margin: auto;
      padding: 2rem;
      text-align: center;
    }

    .crypto-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .crypto-info img {
      width: 50px;
      height: 50px;
    }

    .select-hours {
      margin-bottom: 1.5rem;
    }

    .select-hours select {
      padding: 0.5rem;
      font-size: 1rem;
      background-color: #1f1f1f;
      color: #fff;
      border: 1px solid #444;
      border-radius: 6px;
    }

    .chart {
      background-color: #1e1e1e;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .chart img {
      width: 100%;
      max-height: 400px;
      object-fit: contain;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #444;
    }

    th {
      background-color: #1f1f1f;
    }

    tr:nth-child(even) {
      background-color: #1a1a1a;
    }

    tr:nth-child(odd) {
      background-color: #222;
    }
  </style>
</head>
<body>

  <header>
    <h1>ü™ô CryptoTracker</h1>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="historial.html">Gr√°ficas por Cripto</a>
      <a href="comparar.html">Comparaci√≥n</a>
      <a href="regresion.html">Regresi√≥n</a>
    </nav>
  </header>

  <div class="container">
    <div class="crypto-info">
      <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="Bitcoin">
      <h2 id="coin-name">Bitcoin (BTC)</h2>
    </div>

    <div class="select-hours">
      <label for="range">Selecciona un rango de horas:</label>
      <select id="range">
        <option value="1">√öltima 1 hora</option>
        <option value="3">√öltimas 3 horas</option>
        <option value="6">√öltimas 6 horas</option>
        <option value="12">√öltimas 12 horas</option>
        <option value="24" selected>√öltimas 24 horas</option>
      </select>
    </div>

    <div class="chart">
      <img id="chart-img" src="http://localhost:8080/chart?coin=bitcoin&hours=24" alt="Gr√°fico hist√≥rico de BTC">
    </div>

    <div id="chart-container"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Obtener el par√°metro 'coin' de la URL
      const urlParams = new URLSearchParams(window.location.search);
      const coinId = urlParams.get('coin') || 'bitcoin'; // Usa bitcoin como valor predeterminado
      
      console.log(`Mostrando historial para: ${coinId}`);
      
      // Actualizar el t√≠tulo y la imagen con la criptomoneda seleccionada
      updateCryptoInfo(coinId);
      
      // Actualizar la imagen del gr√°fico con la criptomoneda seleccionada
      const hours = document.getElementById('range').value;
      document.getElementById('chart-img').src = `http://localhost:8080/chart?coin=${coinId}&hours=${hours}`;
      
      // Configurar el event listener para el cambio de rango
      const rangeSelect = document.getElementById('range');
      rangeSelect.addEventListener('change', () => {
        const hours = rangeSelect.value;
        document.getElementById('chart-img').src = `http://localhost:8080/chart?coin=${coinId}&hours=${hours}`;
      });
      
      // Cargar los datos hist√≥ricos para la criptomoneda espec√≠fica
      fetch(`http://localhost:8080/history?coin=${coinId}&hours=${hours}`)
        .then(res => {
          if (!res.ok) {
            throw new Error(`Error HTTP ${res.status}`);
          }
          return res.json();
        })
        .then(data => {
          console.log("Datos hist√≥ricos recibidos:", data);
          
          // Crear una tabla para mostrar los datos hist√≥ricos
          let tableHtml = `
            <h3>Historial de precios para ${coinId}</h3>
            <table style="width:100%; margin-top:20px; border-collapse:collapse;">
              <thead>
                <tr style="background-color:#1f1f1f;">
                  <th style="padding:10px; text-align:left; border-bottom:1px solid #444;">Fecha/Hora</th>
                  <th style="padding:10px; text-align:right; border-bottom:1px solid #444;">Precio (USD)</th>
                </tr>
              </thead>
              <tbody>
          `;
          
          if (data.length === 0) {
            tableHtml += `
              <tr>
                <td colspan="2" style="padding:10px; text-align:center;">No hay datos disponibles</td>
              </tr>
            `;
          } else {
            data.forEach((point, index) => {
              // Formatear la fecha
              const date = new Date(point.timestamp);
              const formattedDate = date.toLocaleString();
              
              // Formatear el precio con 2 decimales
              const formattedPrice = point.price.toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              });
              
              // Alternar colores de fila para mejor legibilidad
              const rowColor = index % 2 === 0 ? '#1a1a1a' : '#222';
              
              tableHtml += `
                <tr style="background-color:${rowColor};">
                  <td style="padding:10px; border-bottom:1px solid #333;">${formattedDate}</td>
                  <td style="padding:10px; text-align:right; border-bottom:1px solid #333;">$${formattedPrice}</td>
                </tr>
              `;
            });
          }
          
          tableHtml += `
              </tbody>
            </table>
          `;
          
          document.getElementById('chart-container').innerHTML = tableHtml;
        })
        .catch(error => {
          console.error("Error al obtener datos hist√≥ricos:", error);
          document.getElementById('chart-container').innerHTML = 
            `<p style="color: red;">‚ùå No se pudieron cargar los datos hist√≥ricos para ${coinId}. Error: ${error.message}</p>`;
        });
    });

    // Funci√≥n para actualizar la informaci√≥n de la criptomoneda
    function updateCryptoInfo(coinId) {
      // Mapeo de IDs a nombres y s√≠mbolos (puedes expandir esto seg√∫n sea necesario)
      const cryptoInfo = {
        'bitcoin': { name: 'Bitcoin', symbol: 'BTC', logo: 'https://cryptologos.cc/logos/bitcoin-btc-logo.png' },
        'ethereum': { name: 'Ethereum', symbol: 'ETH', logo: 'https://cryptologos.cc/logos/ethereum-eth-logo.png' },
        'dogecoin': { name: 'Dogecoin', symbol: 'DOGE', logo: 'https://cryptologos.cc/logos/dogecoin-doge-logo.png' },
        'cardano': { name: 'Cardano', symbol: 'ADA', logo: 'https://cryptologos.cc/logos/cardano-ada-logo.png' },
        'solana': { name: 'Solana', symbol: 'SOL', logo: 'https://cryptologos.cc/logos/solana-sol-logo.png' },
        'ripple': { name: 'XRP', symbol: 'XRP', logo: 'https://cryptologos.cc/logos/xrp-xrp-logo.png' },
        'chainlink': { name: 'Chainlink', symbol: 'LINK', logo: 'https://cryptologos.cc/logos/chainlink-link-logo.png' },
        'bitcoin-cash': { name: 'Bitcoin Cash', symbol: 'BCH', logo: 'https://cryptologos.cc/logos/bitcoin-cash-bch-logo.png' },
        'hyperliquid': { name: 'Hyperliquid', symbol: 'HYP', logo: 'https://via.placeholder.com/150' },
        'tron': { name: 'Tron', symbol: 'TRX', logo: 'https://cryptologos.cc/logos/tron-trx-logo.png' }
      };

      // Obtener informaci√≥n para la moneda seleccionada o usar valores predeterminados
      const info = cryptoInfo[coinId] || { name: coinId, symbol: coinId.toUpperCase(), logo: 'https://via.placeholder.com/150' };
      
      // Actualizar la interfaz con la informaci√≥n de la criptomoneda
      document.querySelector('.crypto-info img').src = info.logo;
      document.getElementById('coin-name').textContent = `${info.name} (${info.symbol})`;
      
      // Actualizar el t√≠tulo del gr√°fico
      document.querySelector('.chart img').alt = `Gr√°fico hist√≥rico de ${info.symbol}`;
    }
  </script>

</body>
</html>
